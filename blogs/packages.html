<!--
    Anurag Roy's portfolio website
    Copyright (C) 2020-2022 Anurag Roy

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="subject" content="I took compiling from source to the next level | Anurag Roy">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/media-query.css">
    <link rel="stylesheet" href="../css/themes.css">

    <!-- Miscellaneous -->
    <link rel="author" href="https://royarg02.github.io">
    <link rel="me" href="mailto:anuragr9847@gmail.com">
    <meta name="copyright" content="Anurag Roy">
    <link rel="license" href="https://creativecommons.org/licenses/by-nd/4.0">

    <title>I took compiling from source to the next level | Anurag Roy</title>
  </head>
  <body>
    <header id="header">
      <h1 id="header-title"><a href="../index.html#intro">Anurag Roy</a></h1>
      <nav id="header-link">
        <a href="../index.html#blogs" title="Blogs I've written">Blogs</a
        ><a href="../index.html#talks" title="Talks I've given">Talks</a
        ><a href="../index.html#contributions" title="My contributions">Contributions</a
        ><a href="../index.html#projects" title="Projects I've worked on">Projects</a>
      </nav>
    </header>
    <main>
      <article>
        <h2 class="heading">I took compiling from source to the next level</h2>
        <p class="para">27 May 2022</p>
        <aside>
          <figure>
            <img src="https://imgs.xkcd.com/comics/automation.png" alt="Automation comic by xkcd">
            <figcaption class="caption">
              <a href="https://xkcd.com/1319" target="_blank">Automation</a>
              by <a href="https://xkcd.com" target="_blank">xkcd</a>
              / <a href="https://creativecommons.org/licenses/by-nc/2.5" target="_blank">CC BY-NC 2.5</a>
            </figcaption>
          </figure>
        </aside>
        <p class="para">
          I use various suckless(or suckless like) software, including the
          <a href="https://github.com/RoyARG02/dwm" target="_blank">window manager</a>,
          the <a href="https://github.com/RoyARG02/dmenu" target="_blank">"run" launcher</a>,
          the <a href="https://github.com/RoyARG02/dwmblocks" target="_blank">status bar</a>
          and the <a href="https://github.com/RoyARG02/st" target="_blank">terminal</a>
          on my Linux machine.
        </p>
        <p class="para">
          One of the main features of these "suckless-like" software is that they have to be built from the source
          since that is the only way for configuration. The typical installation comprises these steps:
        </p>
        <ul>
          <li>
            You get the source code itself(for instance, through <code>git clone</code>),
          </li>
          <li>
            You modify the source code or apply patches to add features not available in the vanilla build,
          </li>
          <li>
            You run <code>make</code>, and if compilation is successful, <code>make install</code> to install the built binary.
          </li>
        </ul>
        <p class="para">
          However, these are not managed by the package manager, creating issues with dependency management.
          My build requires additional dependencies(and thus not documented upstream), and removing them might leave
          their dependencies around.
        </p>
        <p class="para">
          Also, if I migrate my setup, I can have most of my packages installed using a single command, thanks to a generated list
          from the package manager. But it would require the "clone-make-make install" ritual for the source builds.
        </p>
        <p class="para">
          It led me to consider making binary packages of my custom suckless software, requiring me to write a package description
          file(also known as <a href="https://wiki.archlinux.org/title/PKGBUILD" target="_blank">PKGBUILD</a>
          in Arch-based distros)...
        </p>
        <p class="para">
          "... and posting them to the AUR." would be the first guess for any Arch user. However, it is possible to have these
          packages removed from the AUR as these are merely user-specific builds of another software. Thus I would have to make
          <em>my</em> package repository.
        </p>
        <h3 class="subheading">Making the package repository(and automating it)</h3>
        <p class="para">
          A package repository contains some package files(among others) having the extension <code>pkg.tar.zst</code>. Navigating to a specific address based
          on the directory listing of these files would provide you with the actual package file.
        </p>
        <p class="para">
          I figured <strong>GitHub pages</strong> would be best suited for it. I could have a repository having a <code>os/x86_64</code>
          folder and dump all the built packages there.
        </p>
        <p class="para">
          So I went looking for guides for writing PKGBUILDs and creating user repositories. But most of them rely on <em>manually</em> building the
          packages, <em>manually</em> copying packages to the database, <em>manually</em> building the database repo, and <em>manually</em>
          pushing the changes along with the updated packages to the remote. Too much <em>manual</em> interference is something I would rather not have
          in my setup, and thus led me to use <strong>GitHub Actions</strong> for automation.
        </p>
        <p class="para">
          Having no experience, using it was easy due to its <code>YAML</code> syntax. I chained together multiple actions to suit my purpose.
        </p>
        <p class="para">
          My source repositories can have multiple commits a day, and I wouldn't want to trigger the action on every push.
          They are instead triggered by a change to the PKGBUILDs. Here is how it is wired, as of writing this blog:
        </p>
        <ul>
          <li>
            I push the updated source code to the source repo,
          </li>
          <li>
            I push the updated PKGBUILD to the package repo, triggering a build of the new package,
          </li>
          <li>
            The package is then
            <a href="https://github.com/RoyARG02/st-royarg-git/blob/master/.github/workflows/package-upload.yaml" target="_blank">committed</a>
            to the database repo,
          </li>
          <li>
            The database then
            <a href="https://github.com/RoyARG02/royarg-repo/blob/master/.github/workflows/build-database.yaml" target="_blank">builds</a>
            itself, incorporating the new packages.
          </li>
        </ul>
        <h3 class="subheading">Packages available in the repo</h3>
        <p class="para">
          Currently, the following packages are available in the repository:
        </p>
        <ul>
          <li>
            <a href="https://github.com/RoyARG02/dmenu-royarg-git" target="_blank"><strong>dmenu-royarg-git</strong></a>
          </li>
          <li>
            <a href="https://github.com/RoyARG02/dwm-royarg-git" target="_blank"><strong>dwm-royarg-git</strong></a>
          </li>
          <li>
            <a href="https://github.com/RoyARG02/dwmblocks-royarg-git" target="_blank"><strong>dwmblocks-royarg-git</strong></a>
          </li>
          <li>
            <a href="https://github.com/RoyARG02/lf-royarg-bin" target="_blank"><strong>lf-royarg-bin</strong></a>
          </li>
          <li>
            <a href="https://github.com/RoyARG02/slock-royarg-git" target="_blank"><strong>slock-royarg-git</strong></a>
          </li>
          <li>
            <a href="https://github.com/RoyARG02/st-royarg-git" target="_blank"><strong>st-royarg-git</strong></a>
          </li>
        </ul>
        <p class="para">
          The built package files are located <a href="https://github.com/RoyARG02/royarg-repo" target="_blank">here</a>.
          Instructions to have these packages are in the
          <a href="https://github.com/RoyARG02/royarg-repo/blob/master/README.md" target="_blank">README</a>
          or can be found directly at <a href="https://royarg02.github.io/royarg-repo">https://royarg02.github.io/royarg-repo</a>.
        </p>
        <p class="para">
          With that said, if you want to, go ahead and try those packages!
        </p>
        <p class="para">
          Until next time.
        </p>
        <hr>
      </article>
    </main>
      <footer>
        <div id="footer-start">
          <div id="license-blog">This work is licensed under
            <a href="https://creativecommons.org/licenses/by-nd/4.0" target="_blank">CC&nbsp;BY&#8209;ND&nbsp;4.0</a>.
          </div>
          <div id="license-code">Source code is licensed under
            <a href="https://www.gnu.org/licenses/gpl-3.0.html" target="_blank">GNU&nbsp;GPL&nbsp;3.0</a>.
          </div>
        </div>
        <div id="footer-end">
          <div id="copyright">Copyright &copy; Anurag Roy 2020-2022.</div>
          <div id="powered-by">
            Powered by good ol' HTML5, CSS3 and
            <a href="https://pages.github.com"> Github&nbsp;Pages</a>.
          </div>
        </div>
      </footer>
  </body>
</html>
